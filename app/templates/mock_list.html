<!DOCTYPE html>
<html>
<head>
    <title>Mock List</title>
</head>
<body>
    <h1>All Mocked Endpoints</h1>

    <table border="1">
        <tr>
            <th>ID</th>
            <th>Path</th>
            <th>Method</th>
            <th>Response</th>
            <th>Action</th>
            <th style="max-width:200px; word-break:break-all;">cURL</th>
        </tr>
        {% for mock in mocks %}
    <tr>
    <form method="post" action="/update-mock">
        <td>
            {{ mock.id }}
            <input type="hidden" name="mock_id" value="{{ mock.id }}">
        </td>
        <td>
            <input type="text" name="path" value="{{ mock.path }}">
        </td>
        <td>
            <select name="method">
                <option value="GET" {% if mock.method == 'GET' %}selected{% endif %}>GET</option>
                <option value="POST" {% if mock.method == 'POST' %}selected{% endif %}>POST</option>
                <option value="PUT" {% if mock.method == 'PUT' %}selected{% endif %}>PUT</option>
                <option value="DELETE" {% if mock.method == 'DELETE' %}selected{% endif %}>DELETE</option>
            </select>
        </td>
        <td>
            <textarea name="response" rows="6" cols="50">{{ mock.response }}</textarea>
        </td>
        <td>
            <button type="submit">Update</button>
    </form>

    <form method="post" action="/delete-mock" style="display:inline;">
        <input type="hidden" name="mock_id" value="{{ mock.id }}">
        <button type="submit" onclick="return confirm('Delete this mock?')">Delete</button>
    </form>

    <!-- cURL column -->
    <td style="font-family:monospace; font-size:0.95em; max-width:200px; word-break:break-all; white-space:pre-wrap;">
        {% set curl_cmd = "" %}
        {% if mock.method == 'GET' %}
            {% set curl_cmd = "curl -X GET '" ~ request.base_url ~ 'mocked' ~ mock.path ~ "'" %}
        {% elif mock.method == 'POST' %}
            {% set curl_cmd = "curl -X POST '" ~ request.base_url ~ 'mocked' ~ mock.path ~ "' -d '" ~ (mock.response|replace("'", "\'") if mock.response else '') ~ "' -H 'Content-Type: application/json'" %}
        {% elif mock.method == 'PUT' %}
            {% set curl_cmd = "curl -X PUT '" ~ request.base_url ~ 'mocked' ~ mock.path ~ "' -d '" ~ (mock.response|replace("'", "\'") if mock.response else '') ~ "' -H 'Content-Type: application/json'" %}
        {% elif mock.method == 'DELETE' %}
            {% set curl_cmd = "curl -X DELETE '" ~ request.base_url ~ 'mocked' ~ mock.path ~ "'" %}
        {% endif %}
        <span id="curl-{{ mock.id }}">{{ curl_cmd }}</span>
        <button type="button" onclick="copyCurl('{{ mock.id }}')">Copy</button>
    </td>
        </td>
</tr>

        {% endfor %}
    </table>

    <p><a href="/mock-ui">Create New Mock</a></p>
<script>
function copyCurl(id) {
    var text = document.getElementById('curl-' + id).innerText;
    navigator.clipboard.writeText(text);
}
</script>
</body>
</html>
